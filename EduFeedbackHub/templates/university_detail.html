<body>
    <!-- Back link to the year ranking page -->
    <p>
        <a href="{% url 'qs_year_detail' current_year %}">
            Back to {{ current_year }} Rankings
        </a>
    </p>

    <!-- University name and region -->
    <h2>{{ university.name }} ({{ university.region }})</h2>

    <!-- Comment submission form -->
    <h3>Leave a Comment</h3>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Submit</button>
    </form>

    <!-- Display comments -->
    <h3>Comments</h3>
    {% for comment in comments %}
        <div style="margin-bottom: 20px;">
            <p>
                {{ comment.content }} <br>
                <small>{{ comment.created_at }}</small>
                <!-- Delete comment button -->
                <form action="{% url 'delete_comment' comment.id %}?year={{ current_year }}" method="post" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" onclick="return confirm('Are you sure you want to delete this comment?');">Delete
                    </button>
                </form>
            </p>

            <!-- Replies to the comment -->
            {% for reply in comment.replies.all %}
                <div style="margin-left: 20px;">
                    <p>
                        {{ reply.content }} <br>
                        <small>{{ reply.created_at }}</small>
                        <!-- Delete reply button -->
                        <form action="{% url 'delete_comment' reply.id %}?year={{ current_year }}" method="post" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" onclick="return confirm('Are you sure you want to delete this reply?');">
                                Delete
                            </button>
                        </form>
                    </p>
                </div>
            {% endfor %}

            <!-- Reply form under each comment -->
            <form method="post" style="margin-left: 20px;">
                {% csrf_token %}
                <input type="hidden" name="parent_id" value="{{ comment.id }}">
                {{ form.as_p }}
                <button type="submit">Reply</button>
            </form>
        </div>
    {% empty %}
        <!-- Message if no comments -->
        <p>No comments yet.</p>
    {% endfor %}
</body>
